
# 个性化图像美学评分预测系统

![Gradio UI 示例图](https://img.shields.io/badge/Gradio-UI-blueviolet)
![PyTorch](https://img.shields.io/badge/PyTorch-Deep%20Learning-red)
![Scikit-learn](https://img.shields.io/badge/Scikit--learn-ML%20Models-orange)
![Python](https://img.shields.io/badge/Python-3.x-green)

## 🎯 项目概述

回归任务。

本项目是一个交互式的图像美学评分系统，旨在根据图像内容预测其美学分数。

系统采用**深度特征提取与多种机器学习回归模型相结合**的策略，并提供了一个直观的 Gradio 用户界面，方便用户进行数据管理、模型训练、模型比较以及图片预测。

通过该系统，用户可以导入自己的图片集并进行分数标注，利用强大的预训练深度学习模型（如 ResNet、VGG、EfficientNet 等）提取高级视觉特征，然后使用传统机器学习算法（如随机森林、梯度提升、支持向量回归等）或微调的深度学习模型进行回归预测。

## ✨ 主要功能与特性

*   **原始数据导入：**
    *   从本地文件夹批量加载图片。
    *   自动从图片文件名中解析初始美学分数（例如：`85.jpg` 会解析为 85 分）。
    *   提供画廊式图片预览、单张图片分数编辑和表格批量编辑功能。
    *   将处理后的图片和分数保存到项目内部的训练数据目录 (`data/`)。
*   **训练数据管理：**
    *   浏览和管理已保存到 `data/` 目录的训练图片及其分数。
    *   支持对现有分数进行实时编辑（修改后自动保存）。
    *   支持上传新图片并添加分数，或仅添加现有文件名（假设已在 `data/` 中）和分数。
    *   支持删除图片文件及其对应的分数记录。
*   **多模型训练与比较：**
    *   **深度学习 (分离模式)：** 使用预训练的 CNN 模型（如 ResNet50）作为固定的特征提取器，仅训练一个小型全连接回归头。
    *   **端到端深度学习 (微调模式)：** 微调整个预训练 CNN 模型（例如 ResNet50）及其回归头。
    *   **传统机器学习模型：**
        *   **随机森林回归 (Random Forest Regressor)**
        *   **支持向量回归 (Support Vector Regressor)**
        *   **梯度提升回归 (Gradient Boosting Regressor)**
        *   **堆叠回归 (Stacking Regressor)**
    *   **灵活的基础 CNN 选择：** 用户可以在 UI 界面选择 ResNet18、ResNet50、VGG16、DenseNet121、EfficientNet-B0、InceptionV3 等作为深度学习模式（分离或端到端）的基础模型。
    *   自定义训练轮次 (Epochs) 和学习率 (Learning Rate)。
    *   实时显示训练损失曲线。
*   **图片预测：**
    *   上传单张图片。
    *   选择已训练的模型类型和基础 CNN 模型进行预测。
    *   显示预测的美学分数。

## 🛠️ 技术栈

*   **编程语言：** Python 3.x
*   **深度学习框架：** PyTorch
*   **机器学习库：** Scikit-learn
*   **UI 框架：** Gradio
*   **图像处理：** PIL (Pillow), torchvision
*   **数据操作：** Pandas, NumPy
*   **可视化：** Matplotlib

## 🚀 安装与运行

### 1. 克隆项目仓库

```bash
git clone <your-repository-url> # 如果有的话，否则直接下载代码
cd 图像美学评分系统项目目录
```

### 2. 创建并激活虚拟环境 (推荐)

```bash
python -m venv venv
# Windows
.\venv\Scripts\activate
# macOS / Linux
source venv/bin/activate
```

### 3. 安装依赖

请确保您的 `pip` 版本是最新，然后安装 `requirements.txt` 中的依赖：

```bash
pip install -r requirements.txt
```
如果遇到 `torch` 和 `torchvision` 的安装问题，请参考 PyTorch 官方网站的安装指南，根据您的 CUDA 版本（如果使用 GPU）进行安装。

**`requirements.txt` 示例内容：**

```
gradio==3.40.1  # 重要：保持此版本以避免兼容性问题
torch>=1.9.0
torchvision>=0.10.0
scikit-learn
pandas
matplotlib
Pillow
numpy
joblib
```

### 4. 运行应用

```bash
python gradio_app.py
```

应用程序将在您的浏览器中自动打开（通常是 `http://127.0.0.1:7860`）。

## 💡 使用说明

### 1. 原始数据导入

*   在“**原始数据导入**”标签页，输入您存放原始图片文件夹的**绝对路径**。
*   点击“**加载图片**”，系统会识别图片并尝试从文件名中解析分数。
*   您可以通过画廊预览图片，点击图片或使用导航按钮切换。
*   在右侧分数输入框中修改当前图片的分数，点击“确定”或按回车。
*   也可以直接在下方的表格中修改分数。
*   **修改完成后，点击“保存数据到训练目录”**。这会将图片复制到项目根目录的 `data/` 文件夹中，并生成 `scores.txt` 文件，供后续训练使用。

### 2. 训练数据管理

*   切换到“**训练数据管理**”标签页。
*   点击“**加载训练数据**”，系统会读取 `data/` 目录中的图片和 `scores.txt` 文件。
*   该页面同样提供画廊预览和分数编辑功能。在此页面进行的任何分数修改、图片添加或删除操作，都将**立即同步保存**到 `data/` 目录和 `scores.txt` 文件中。
*   **添加条目：** 可以上传新的图片文件，或仅输入文件名和分数（假定文件已在 `data/` 目录中），然后点击“添加条目”。
*   **删除条目：** 输入要删除的图片文件名，点击“删除条目”。此操作将同时删除文件和记录。

### 3. 训练模型

*   切换到“**训练模型**”标签页。
*   **确保您已在“原始数据导入”或“训练数据管理”页面保存了数据。**
*   在“**选择模型类型**”下拉菜单中选择您想训练的回归模型。
*   如果选择了“深度学习”或“端到端深度学习”，会出现“**选择基础CNN模型**”下拉菜单，选择您想使用的预训练 CNN 架构（如 ResNet50）。
*   调整“训练轮次”和“学习率”。
*   点击“**开始训练**”。训练过程中的损失曲线会实时绘制。
*   训练完成后，模型文件将自动保存到 `trained_models_storage/` 目录。

### 4. 预测图片

*   切换到“**预测图片**”标签页。
*   选择您之前训练过的模型类型和基础 CNN 模型。
*   上传一张新的图片。
*   点击“**预测**”，系统将显示图片的美学评分。

## 🚀 优化建议与未来工作

本项目已具备基础的图像美学评分功能，但仍有许多可以优化和拓展的空间，以提高模型性能和系统可用性：

*   **模型准确率优化：**
    *   **更多数据：** 扩充和多样化数据集，是提高模型泛化能力最有效的方法。
    *   **超参数调优：** 系统性地对学习率、批量大小、优化器类型、Dropout 率等进行调优（可考虑网格搜索、随机搜索或贝叶斯优化）。
    *   **损失函数：** 尝试除 MSE 外的其他损失函数，如 MAE (Mean Absolute Error) 或 Huber Loss，以应对异常值或不同误差敏感度。
    *   **更强的数据增强：** 引入 `RandomRotation`、`RandomAffine`、`RandomErasing` 等更多数据增强技术。
    *   **更先进的模型：** 尝试更大的 EfficientNet 系列模型（如 B1-B7），甚至探索 Vision Transformer (ViT) 或 Swin Transformer 等前沿架构。
    *   **集成学习：** 进一步优化堆叠回归器的基学习器和元学习器，或尝试其他集成策略。
*   **模型可控性与透明度：**
    *   **验证集监控：** 在训练过程中引入验证集，并实时绘制训练损失和验证损失曲线，实现早期停止。
    *   **评估指标：** 在训练结束后，显示更多评估指标（如 R2 Score, MAE），而不仅仅是损失。
    *   **模型可视化：** 增加 Grad-CAM 等工具，可视化模型关注的图像区域，提升模型解释性。
*   **系统功能增强：**
    *   **数据集拆分：** 在数据准备阶段提供训练集、验证集和测试集的划分选项。
    *   **模型管理：** 提供更精细的模型保存/加载机制，例如根据实验ID或日期管理不同训练结果的模型。
    *   **批量预测：** 支持一次性上传多张图片进行批量预测。


